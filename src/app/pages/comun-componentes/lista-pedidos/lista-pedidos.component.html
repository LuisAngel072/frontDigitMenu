<div class="order-system-container">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid d-flex justify-content-between">
      <div class="navbar-icons-head">
        <a class="navbar-brand" href="#">
          <span class="logo">
            <span class="logo-digit">DIGIT</span>
            <span class="logo-menu">MENU</span>
          </span>
        </a>
        <button class="btn navbar-icon" (click)="toggleSidebar()">
          <span class="material-symbols-outlined" style="color: #ff8800; font-size: 24px">
            chef_hat
          </span>
        </button>
        <button class="btn navbar-icon notification-btn" (click)="toggleNotifications()">
          <i class="bi bi-bell" style="color: #3498db; font-size: 24px"></i>
          <span *ngIf="unreadNotifications > 0" class="notification-badge">
            {{ unreadNotifications }}
          </span>
        </button>
        <button class="btn navbar-icon" (click)="toggleNavigation()">
          <span class="material-symbols-outlined">menu</span>
        </button>
      </div>
    </div>
  </nav>

  <div class="content-container">
    <!-- NAV SIDEBAR -->
    <div class="sidebar nav-sidebar" [class.open]="navOpen">
      <div class="sidebar-header">
        <h4 class="m-3">Navegaci√≥n</h4>
      </div>
      <div class="nav-items">
        <div *ngFor="let item of navItems" class="nav-item" (click)="navigate(item.route)">
          <i [class]="'bi ' + item.icon"></i>
          <span>{{ item.name }}</span>
        </div>
      </div>
    </div>

    <!-- ORDER SIDEBAR -->
    <div class="sidebar order-sidebar" [class.open]="sidebarOpen">
      <div class="sidebar-header">
        <h4 class="m-3">Pedidos Activos</h4>
      </div>
      <div class="orders-container">
        <div *ngIf="isLoading" class="text-center p-3">Cargando...</div>
        <div *ngIf="!isLoading && pedidosAgrupados.length === 0" class="text-center p-3">
          <p>No hay pedidos pendientes.</p>
        </div>
        <div class="accordion" id="ordersAccordion">
          <div class="accordion-item" *ngFor="let pedido of pedidosAgrupados; let i = index">
            <h2 class="accordion-header" [id]="'heading' + i">
              <button 
                class="accordion-button" 
                type="button" 
                (click)="pedido.expandido = !pedido.expandido" 
                [class.collapsed]="!pedido.expandido"
              >
                Mesa {{ pedido.pedidoId.no_mesa.no_mesa }}
                <span 
                  class="badge ms-2" 
                  [ngClass]="{
                    'bg-warning text-dark': pedido.tieneProductosPendientes, 
                    'bg-success': !pedido.tieneProductosPendientes
                  }"
                >
                  {{ pedido.tieneProductosPendientes ? 'Pendiente' : 'OK' }}
                </span>
              </button>
            </h2>
            <div class="accordion-collapse collapse" [class.show]="pedido.expandido">
              <div class="accordion-body">
                <div class="order-actions mb-2">
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      [id]="'selectAll' + i" 
                      (change)="marcarPedidoCompleto(pedido)"
                    >
                    <label class="form-check-label" [for]="'selectAll' + i">
                      Marcar todo como preparado
                    </label>
                  </div>
                </div>
                <div class="order-items-list">
                  <div class="order-item" *ngFor="let producto of pedido.productos">
                    <div class="item-info">
                      <span class="item-name cocogoose-font">
                        {{ producto.producto_id.nombre_prod }}
                      </span>
                      <small class="text-muted d-block cocogoose-font">
                        {{ producto.opcion_id.nombre_opcion }}
                      </small>
                      <span 
                        class="status-text" 
                        [ngClass]="{
                          'text-warning': producto.estado === 'Sin preparar', 
                          'text-success': producto.estado === 'Preparado'
                        }"
                      >
                        {{ producto.estado }}
                      </span>
                    </div>
                    <div class="status-controls">
                      <span 
                        class="material-symbols-outlined delete-icon" 
                        *ngIf="puedeEliminarProducto(producto)" 
                        (click)="eliminarProductoDelPedido(producto, pedido)"
                      >
                        delete
                      </span>
                      <input
                        class="form-check-input"
                        type="checkbox"
                        [checked]="producto.estado === 'Preparado'"
                        (change)="cambiarEstadoProducto(producto, pedido)"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- NOTIFICATIONS SIDEBAR -->
    <div class="sidebar notifications-sidebar" [class.open]="notificationsOpen">
      <div class="sidebar-header">
        <h4 class="m-3">Notificaciones</h4>
      </div>
      <div class="notifications-container">
        <div *ngIf="allNotifications.length === 0" class="text-center p-3">
          <i class="bi bi-bell-slash" style="font-size: 48px; color: #ccc;"></i>
          <p class="mt-2 text-muted">No hay notificaciones pendientes</p>
        </div>
        
        <div 
          class="notification-item" 
          *ngFor="let notif of allNotifications"
          [class.unread]="notif.estado === 'pendiente'"
        >
          <div class="notification-header">
            <span class="table-badge">Mesa {{ notif.no_mesa }}</span>
          </div>
          <div class="notification-body">
            <p class="notification-message">{{ notif.mensaje }}</p>
          </div>
          <div class="notification-footer">
            <button 
              class="btn btn-sm btn-primary" 
              (click)="atenderNotificacion(notif.id_notf, notif.no_mesa!)"
            >
              <i class="bi bi-check-circle"></i> Atender
            </button>
            <button 
              class="btn btn-sm btn-outline-secondary" 
              (click)="goToOrder(notif.no_mesa!)"
            >
              <i class="bi bi-eye"></i> Ver pedido
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div 
      class="main-content" 
      [class.shifted]="sidebarOpen || notificationsOpen || navOpen"
    >
      <div class="tables-container">
        <ng-content></ng-content>
      </div>
    </div>
  </div>
</div>