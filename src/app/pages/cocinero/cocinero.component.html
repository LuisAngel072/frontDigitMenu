<app-header> </app-header>

<div class="main-content">
  <div class="col-12">
    <div class="container-fluid py-3">
      <div class="row gx-3 gy-4" style="max-height: 85vh; overflow-y: auto">
        <div *ngIf="isLoading" class="col-12 text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p>Cargando pedidos...</p>
        </div>
        <div
          *ngIf="!isLoading && pedidosAgrupados.length === 0"
          class="col-12 text-center"
        >
          <h3>No hay pedidos pendientes en cocina.</h3>
        </div>

        <div class="col-md-6 col-xl-3" *ngFor="let pedido of pedidosAgrupados">
          <div class="card shadow-sm border-0 h-100">
            <div
              class="card-header bg-dark text-white d-flex justify-content-between align-items-center"
            >
              <div>
                <strong>Pedido #{{ pedido.pedidoId.id_pedido }}</strong
                ><br />
                Mesa: {{ pedido.pedidoId.no_mesa.no_mesa }}
              </div>
              <button
                class="btn btn-sm btn-outline-light"
                (click)="pedido.expandido = !pedido.expandido"
              >
                {{ pedido.expandido ? "‚àí" : "+" }}
              </button>
            </div>

            <div class="card-body" *ngIf="pedido.expandido">
              <p class="text-muted mb-2">
                <i class="bi bi-clock"></i>
                {{ pedido.pedidoId.fecha_pedido | date : "shortTime" }}
              </p>

              <div
                *ngFor="let producto of pedido.productos"
                class="mb-3 border-bottom pb-2"
              >
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <h6 class="mb-0 fw-bold">
                      {{ producto.producto_id.nombre_prod }}
                    </h6>
                    <small class="text-muted">{{
                      producto.opcion_id.nombre_opcion
                    }}</small>
                    <div
                      *ngIf="producto.extras && producto.extras.length > 0"
                      class="mt-1"
                    >
                      <small
                        ><strong>Extras:</strong>
                        <span
                          *ngFor="let extra of producto.extras; let last = last"
                        >
                          + {{ extra.nombre_extra }}{{ !last ? ", " : "" }}
                        </span>
                      </small>
                    </div>
                    <div
                      *ngIf="
                        producto.ingredientes &&
                        producto.ingredientes.length > 0
                      "
                      class="mt-1"
                    >
                      <small
                        ><strong>Ingredientes:</strong>
                        <span
                          *ngFor="
                            let ing of producto.ingredientes;
                            let last = last
                          "
                        >
                          {{ ing.nombre_ingrediente }}{{ !last ? ", " : "" }}
                        </span>
                      </small>
                    </div>
                  </div>
                  <button
                    class="btn btn-sm btn-success flex-shrink-0 ms-2"
                    (click)="marcarComoPreparado(producto, pedido)"
                  >
                    ‚úîÔ∏è
                  </button>
                </div>
              </div>
            </div>

            <ng-template #resumenPedido>
              <ul class="list-group list-group-flush">
                <li
                  *ngFor="let p of pedido.productos.slice(0, 3)"
                  class="list-group-item"
                >
                  üçΩÔ∏è {{ p.producto_id.nombre_prod }}
                </li>
                <li
                  *ngIf="pedido.productos.length > 3"
                  class="list-group-item text-muted text-center small fst-italic"
                >
                  ...{{ pedido.productos.length - 3 }} m√°s
                </li>
              </ul>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
